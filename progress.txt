## Iteration 1 - Project Setup (Vite + React + Tailwind + PWA)
- Initialized npm project with React 19, Vite 7, Tailwind CSS v4, vite-plugin-pwa
- Created project structure: src/components, src/hooks, src/data, public/assets/watercolors, public/icons
- Set up index.html with viewport meta, Google Fonts (Inter + Playfair Display), theme-color
- Created src/index.css with Tailwind v4 import and all CSS variables from brand guidelines
- Created src/main.jsx and src/App.jsx with basic rendering
- Copied watercolor images to public/assets/watercolors/
- Created .gitignore
- Files changed: package.json, vite.config.js, index.html, src/main.jsx, src/App.jsx, src/index.css, .gitignore
- Learnings for future iterations:
  - The project path contains an apostrophe ("Mama's Birthday") which breaks workbox service worker generation. vite-plugin-pwa is installed but disabled in vite.config.js. Re-enable when deploying from a clean CI path.
  - Tailwind v4 uses `@import "tailwindcss"` instead of the old `@tailwind` directives
  - Using `type: "module"` in package.json for ESM
  - Build verified working with `npx vite build`
---

## Iteration 2 - Tile Rendering
- Created src/data/tiles.js with all 144 tile definitions (Dots/Bams/Craks x9x4, Winds x4x4, Dragons x3x4, Flowers x4, Seasons x4)
- Includes tile labels, suit labels (Chinese characters), color mappings per suit, flower/season image mappings
- Includes tilesMatch() function with special flower/season matching rules
- Includes generateTileSet() that produces exactly 144 tiles
- Created src/components/Tile.jsx - renders individual tile with:
  - Watercolor background tint per suit (Dots=blue, Bams=green, Craks=pink, etc.)
  - Full watercolor painting background (30% opacity) for flower and season tiles
  - High-contrast symbol + suit label overlay
  - Selected state (lifted, lavender border, enhanced shadow)
  - Blocked/free state (dimmed, desaturated when blocked)
  - Accessible button element with aria-label
- Updated App.jsx to render a preview grid of all unique tile types
- Files changed: src/data/tiles.js (new), src/components/Tile.jsx (new), src/App.jsx (updated), PRD.md
- Learnings for future iterations:
  - Watercolor images available: tiles_1.png through tiles_8.png, tiles_4.jpg/5.jpg/7.jpg are JPG, rest PNG
  - bg-texture.png available for board background texture
  - Tile component uses inline styles for dynamic coloring (suit-specific) + Tailwind for layout
  - generateTileSet() returns tiles with {id, suit, value, copy} - positions added later by layout
  - Build verified with `npx vite build` - passes clean
---

## Iteration 3 - Classic Layout (Turtle/Pyramid with 144 tiles)
- Created src/data/layout.js with the classic "Turtle" Mahjong Solitaire layout
  - 5 layers: Layer 0 (87 tiles), Layer 1 (40), Layer 2 (14), Layer 3 (2), Layer 4 (1 peak) = 144 total
  - Layer 0 has classic turtle body shape with 3 wing tiles (2 left, 1 right)
  - Upper layers offset by +0.5 in x/y so tiles center over 4 tiles below
  - All 144 positions verified unique
- Implemented isTileFree() function for free tile detection:
  - Checks no overlapping tile on higher layer (within 1-unit footprint)
  - Checks at least one side (left or right) is open
  - Validated: 26 free tiles on fresh board, peak is free, center bottom blocked
- Implemented getLayoutBounds() for board centering/scaling calculations
- Created src/components/Board.jsx:
  - Renders all tiles with absolute positioning based on grid coordinates
  - 3D stacking visual with layer offsets (LAYER_OFFSET_X=-2, LAYER_OFFSET_Y=-4)
  - Proper z-index ordering (painter's algorithm: sorted by z, y, x)
  - Responsive tile sizing: desktop 60×80, tablet 50×66, mobile 36×48
  - Listens to window resize to adjust tile sizes
- Updated Tile.jsx to accept tileWidth/tileHeight props with proportional font scaling
- Updated App.jsx to use Board component with Fisher-Yates shuffled tiles
  - createGame() shuffles tile definitions and assigns to layout positions
  - Computes free tiles via useMemo for efficient re-rendering
  - Selection toggle (match logic deferred to later task)
- Files changed: src/data/layout.js (new), src/components/Board.jsx (new), src/components/Tile.jsx (updated), src/App.jsx (updated), PRD.md
- Learnings for future iterations:
  - Layout uses half-unit coordinates (e.g., 0.5, 3.5) for layer offsets and wing positions
  - isTileFree uses OVERLAP_THRESHOLD of 0.99 to handle floating point comparisons
  - Left/right neighbor detection uses exact match (0.01 tolerance) on x offset of 1, with y overlap within 1 unit
  - Board component computes pixel positions: (gridX - minX) * tileW + z * layerOffsetX
  - Free tile detection runs on every tiles state change — may need optimization later if slow
  - Build verified with `npx vite build` - passes clean
---

## Iteration 4 - Responsive Design (Desktop + Mobile)
- Rewrote Board.jsx to auto-scale tiles to fit available viewport space
  - Measures container content area (accounting for padding) on mount and resize
  - Calculates max tile width that fits both dimensions using layout bounds and aspect ratio
  - Clamped to min 32px (touch target) / max 60px (desktop cap)
  - Layer offsets scale proportionally with tile size (ratio-based instead of fixed pixels)
- Updated App.jsx layout structure:
  - Header uses flex-shrink-0 with compact padding on mobile (py-2) and more on desktop (lg:py-3)
  - Title text scales: text-lg on mobile, sm:text-xl tablet, lg:text-3xl desktop
  - Board area uses flex-1 min-h-0 to fill remaining viewport height
  - overflow-hidden on root container prevents scrolling
- Updated Tile.jsx:
  - Added `tile-free` CSS class for hover targeting
  - Border width scales proportionally with tile size
  - Border radius scales proportionally
  - Font sizes have minimum floors to stay readable at small tile sizes
- Added CSS hover/touch states in index.css:
  - `@media (hover: hover) and (pointer: fine)` — desktop-only hover: lavender glow + slight lift
  - `.tile:active` — tap feedback with scale(0.96) on all devices
- Files changed: src/components/Board.jsx (rewritten), src/components/Tile.jsx (updated), src/App.jsx (updated), src/index.css (updated), PRD.md
- Learnings for future iterations:
  - Board auto-scaling math: gridW = bounds.width + layers * |layerOffXRatio|, gridH = bounds.height / TILE_ASPECT + layers * |layerOffYRatio| / TILE_ASPECT. tileW = min(availW/gridW, availH/gridH)
  - Must subtract padding from clientWidth/Height when measuring container (getComputedStyle)
  - `@media (hover: hover) and (pointer: fine)` correctly excludes touch devices from hover effects
  - MIN_TILE_W of 32px is safe — tiles overlap in layout so effective touch targets are larger than individual tile size
  - Build verified with `npx vite build` - passes clean
---

## Iteration 5 - Tile Selection (Click/tap to select, visual highlight)
- Refined tile selection visual feedback in Tile.jsx:
  - Changed selected border color from --color-lavender to --color-rose (pink) for stronger contrast
  - Added rose-tinted glow shadow on selected state (scales with tile size)
  - Added `tile-selected` CSS class for hover/active rule targeting
  - Updated aria-label to include "(selected)" state for accessibility
- Updated index.css:
  - Hover effect now excludes already-selected tiles (`:not(.tile-selected)`)
  - Added `:focus-visible` outline (blue, 2px) for keyboard accessibility
- Selection logic already in place from iteration 3: App.jsx has selectedId state, toggle on click, only free tiles clickable
- Files changed: src/components/Tile.jsx (updated), src/index.css (updated), PRD.md
- Learnings for future iterations:
  - Vite build hangs in sandboxed shell environment (possibly Node 24 + Vite 7 TTY issue). Module-level validation via `node --input-type=module` works fine as alternative verification.
  - Selection infrastructure (selectedId state, freeTileIds set, handleTileClick callback) already solid from iteration 3
  - Rose (#E87B98) is more visible than lavender (#B8A5D0) for selected state against the cream background
  - All game logic modules pass validation: 144 tiles, 144 layout positions, 26 free tiles on fresh board, match logic correct
---

## Iteration 6 - Free Tile Detection (Only unblocked tiles clickable)
- Feature was already fully implemented across iterations 3-5:
  - isTileFree() in layout.js checks vertical blocking (tiles above) and horizontal blocking (both sides)
  - App.jsx computes freeTileIds via useMemo and passes to Board
  - Board.jsx creates a Set of free IDs and passes free={true/false} to each Tile
  - Tile.jsx disables non-free tiles (disabled attribute, onClick=undefined), dims them (opacity 0.75, saturate 0.7)
- Verified: 26 free tiles on fresh board, peak is free, center bottom blocked, wing tiles correct
- Verified: removing peak tile correctly frees both layer-3 tiles below
- No code changes needed — just marked PRD task complete
- Files changed: PRD.md (marked task [x]), progress.txt
- Learnings for future iterations:
  - Free tile detection was built incrementally across multiple iterations — sometimes tasks are already done when you get to them
  - Vite build continues to hang in sandboxed shell (Node 24 + Vite 7 TTY issue) — use `node --input-type=module` validation instead
  - 26 free tiles is the correct count for the turtle layout on a fresh board
---

## Iteration 7 - Match Logic (Two identical tiles selected → remove both)
- Updated App.jsx handleTileClick to implement full match logic:
  - Import tilesMatch from tiles.js
  - Click first free tile → select it
  - Click same tile → deselect
  - Click second free tile that matches → remove both tiles (set removed: true), clear selection
  - Click second free tile that doesn't match → switch selection to new tile
  - Uses setTiles functional updater inside setSelectedId for safe concurrent state updates
- Match logic uses existing tilesMatch() function from iteration 2:
  - Identical suit + value → match
  - Any flower matches any flower
  - Any season matches any season
  - Same tile ID → no self-match
- Files changed: src/App.jsx (updated), PRD.md (marked task [x])
- Learnings for future iterations:
  - handleTileClick uses [tiles] in useCallback dependency array since it reads tiles to find tileA/tileB
  - setTiles is called inside the setSelectedId updater function — React batches these correctly
  - Board.jsx already filters `tile.removed` with `if (tile.removed) return null` — no Board changes needed
  - freeTileIds useMemo already filters out removed tiles — free tile recalculation automatic after removal
  - Vite build still hangs in sandbox — continue using `node --input-type=module` for validation
---

## Iteration 8 - Win Detection (All tiles cleared → celebration screen)
- Added win detection logic to App.jsx:
  - `gameWon` computed via useMemo: `tiles.every(t => t.removed)`
  - `handleNewGame` callback resets tiles to a fresh createGame() and clears selection
  - WinScreen rendered conditionally when gameWon is true
- Created src/components/WinScreen.jsx:
  - Full-screen overlay with semi-transparent cream background (92% opacity)
  - Fade-in animation (800ms ease-in via opacity transition)
  - Circular watercolor hydrangea image (tiles_2.png) with lavender border and shadow
  - "You Win!" heading in Playfair Display, lavender color with subtle text shadow
  - "All tiles cleared — beautifully done!" subtext
  - "Play Again" button with lavender background, hover lift effect, calls onNewGame
  - Responsive sizing: image 48→64→80 rem, text scales with sm/lg breakpoints
- Files changed: src/App.jsx (updated), src/components/WinScreen.jsx (new), PRD.md (marked task [x])
- Learnings for future iterations:
  - Win detection is a simple derived state — no need for separate gameStatus state variable
  - WinScreen uses fixed positioning (z-50) to overlay the board
  - tiles_2.png is the hydrangea image used for the win screen per PRD spec
  - handleNewGame uses useCallback with empty deps since createGame() is a standalone function
  - Vite build still hangs in sandbox — validated via `node --input-type=module` integration test
---

## Iteration 9 - Stuck Detection (No valid moves → offer shuffle or new game)
- Added stuck detection logic to App.jsx:
  - `gameStuck` computed via useMemo: checks all pairs of free tiles for matches
  - Returns false if gameWon (win takes priority over stuck)
  - Returns false if no remaining tiles (empty board = won, not stuck)
  - O(n^2) over free tiles only (typically 20-30 tiles, fast enough)
- Created src/components/StuckScreen.jsx:
  - Full-screen overlay matching WinScreen style (semi-transparent cream, fade-in)
  - "No Moves Left" heading with encouraging subtext
  - Two buttons: "Shuffle Tiles" (primary, lavender filled) and "New Game" (secondary, outlined)
  - Responsive layout: buttons stack vertically on mobile, row on desktop (sm:flex-row)
  - Hover effects matching WinScreen button style
- Added handleShuffle to App.jsx:
  - Separates remaining (not removed) from removed tiles
  - Shuffles tile faces (suit, value, copy) among remaining positions using Fisher-Yates
  - Positions (x, y, z, id) stay fixed — only face assignments change
  - Recombines with removed tiles, sorts by id for stable ordering
  - Clears selection
- Files changed: src/App.jsx (updated), src/components/StuckScreen.jsx (new), PRD.md (marked task [x])
- Learnings for future iterations:
  - Stuck detection must exclude won state to avoid false positives on empty board
  - `freeTiles.length > 0` check prevents empty board from being "stuck"
  - Shuffle preserves positions (x, y, z) and only reassigns faces — avoids breaking layout/free-tile logic
  - freeTileIds is an array (not Set) — used `.includes()` in stuck detection; could optimize with Set if needed
  - Fresh games are almost never stuck (0/20 in testing) due to 26 free tiles from diverse suits
  - Vite build still hangs in sandbox — validated via `node --input-type=module`
---
