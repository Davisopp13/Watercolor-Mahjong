# Watercolor Mahjong — Progress Log

## Previous Sprint Summary
Ralph completed two full PRD sprints overnight:
- Sprint 1: 5-layer Turtle layout, stuck detection, win celebration with birthday message, hint/undo/shuffle, progress indicator, match animations, birthday dedication screen, mobile responsiveness
- Sprint 2: Tile redesign (paintings replacing symbols with variant number badges), audio implementation (mute toggle, background music, sound effects)

## Known Issues Going Into This Sprint
- PWA icon has harsh white background — needs warm cream (#FDF8F0) to match game aesthetic
- Mobile viewport: board scales too small to fit screen — tiles are ~25-30px and untappable. Need zoomed-in scrollable view instead.
- Playable vs blocked tiles: visual contrast is insufficient — hard to tell which tiles are interactive at a glance
- Audio uses Web Audio API synthesized oscillator tones that sound like buzzing — need real mp3 files instead

## Learnings From Previous Sprints
- Tile component structure: button.tile with child divs for overlay, watercolor background, gradient, and content
- Blocked state: applied via `blocked` CSS class on the button element
- Tailwind CSS is the styling framework — use utility classes
- PWA viewport meta already set: `width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no`
- Theme color: #9B8BB8 (purple)
- Board uses absolute positioning for tiles
- 9 watercolor painting assets mapped to tile suits, 4 variants each, 4 copies = 144 tiles
- Audio system exists with mute toggle and localStorage persistence — needs mp3 file swap, not a rewrite
- Icon assets are in the public directory — check for existing generation scripts or source files
- The game's cream/off-white background color is approximately #FDF8F0

---

## Iteration 1 - PWA Icon — Warm Cream Background
- Generated new icon files with cream (#FDF8F0) background using Python/Pillow
- Created: icon-192.png (192x192), icon-512.png (512x512), apple-touch-icon.png (180x180), favicon.ico (32x32)
- Source: logo_tile_icon.png (500x500) composited onto cream background, converted to RGB (no alpha)
- Updated vite.config.js manifest icons to reference properly-sized icon files instead of logo_tile_icon.png
- Updated index.html with favicon.ico, sized icon links, and apple-touch-icon reference
- Manifest background_color was already #FDF8F0, theme_color stays #9B8BB8 (purple for status bar)
- Files changed: public/icons/icon-192.png, public/icons/icon-512.png, public/icons/apple-touch-icon.png, public/favicon.ico, vite.config.js, index.html, PRD.md
- Learnings for future iterations:
  - Vite copies public/ contents to dist/ at root level — favicon.ico goes in public/ not public/icons/
  - No test/typecheck scripts — `npm run build` is the only verification
  - logo_tile_icon.png is a hydrangea tile with transparency around rounded rect shape — the cream fill eliminates white gaps
  - icon-192.png and icon-512.png were previously different artwork (lilac) — now they match the primary logo_tile_icon
---

## Iteration 2 - Mobile Board — Zoomed-In Scrollable View
- On mobile (<768px), tiles now render at 55px wide (73px tall) instead of scaling down to fit viewport
- Board container switches from `overflow: hidden` (desktop) to `overflow: auto` (mobile) for touch scrolling
- Added `-webkit-overflow-scrolling: touch` and `overscroll-behavior: contain` for smooth iOS momentum scroll
- Hidden scrollbars on mobile for clean aesthetic (scrollbar-width: none, ::-webkit-scrollbar display: none)
- Board auto-centers on initial load via `scrollTo()` in a requestAnimationFrame callback
- Auto-center resets on new game (tracks via tiles.length change)
- 20px margin around board on mobile so edges are reachable when scrolled
- Desktop behavior is completely unchanged — still fits board in viewport
- Fixed header and bottom control bar remain fixed and visible (already implemented via fixed positioning in App.jsx)
- Files changed: src/components/Board.jsx, src/index.css, PRD.md, progress.txt
- Learnings for future iterations:
  - Board bounds: width ~15.5 tile-widths, height ~8.5 tile-heights, 5 layers
  - At 55px tile width: board is ~863px wide, ~645px tall — requires scrolling on 375px screens
  - `body { overflow: hidden }` on root does NOT prevent `overflow: auto` on child containers from scrolling
  - `touch-action: manipulation` on body still allows scroll gestures within scrollable children
  - The mobile bottom bar is ~80px total (progress row + controls row), header ~50px
  - `isMobile` state tracks viewport width and switches rendering strategy dynamically on resize
---

## Iteration 3 - Playable vs Blocked Tile Contrast
- Most of the styling was already implemented in a previous iteration (likely during Sprint 2 tile redesign)
- Open tiles: opacity 1, lifted shadow, translateY(-1px), pointer cursor — already correct
- Blocked tiles: dimmed, flat, desaturated, no transform, default cursor — already correct
- Hover states: properly wrapped in @media (hover: hover) and (pointer: fine), excluded from blocked tiles — already correct
- Shake animation on blocked click: keyframe + handler in App.jsx + shakingId state — already correct
- State transition: 300ms ease-out transition on .tile base class — already correct
- TWO small refinements applied:
  - Blocked opacity: 0.5 → 0.45 (PRD spec for starker contrast)
  - Blocked filter: added brightness(0.9) alongside existing grayscale(30%)
- Files changed: src/index.css, PRD.md, progress.txt
- Learnings for future iterations:
  - The tile visual system was mostly built during Sprint 2 — check existing CSS before assuming work is needed
  - All tile states (selected, blocked, hinted, mismatch, shaking) use CSS classes toggled by React props
  - No test/typecheck scripts — `npm run build` is the only verification (confirmed again)
---
